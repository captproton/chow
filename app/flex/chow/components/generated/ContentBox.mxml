<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" label="Content"
  xmlns:rx="org.restfulx.components.rx.*">
  <mx:Script><![CDATA[
    import org.restfulx.Rx;
    import org.restfulx.utils.RxUtils;
    import chow.models.Content;

    [Bindable]
    private var content:Content = new Content();

    private function newContent():void {
      content = new Content();
      contentsList.selectedIndex = -1;
    }

    private function saveContent():void {
      updateModelProperties();
      if (content.id) {
        content.update({onSuccess: onContentUpdate});
      } else {
        content.create({onSuccess: onContentCreate});
      }
    }
  
    private function updateModelProperties():void {
      content.articleId = int(articleIdTextInput.text);
      content.userId = int(userIdTextInput.text);
      content.title = titleTextInput.text;
      content.permalink = permalinkTextInput.text;
      content.excerpt = excerptTextArea.text;
      content.body = bodyTextArea.text;
      content.excerptHtml = excerptHtmlTextArea.text;
      content.bodyHtml = bodyHtmlTextArea.text;
      content.createdAt = createdAtDateTimeTextInput.date;
      content.updatedAt = updatedAtDateTimeTextInput.date;
      content.publishedAt = publishedAtDateTimeTextInput.date;
      content.type = typeTextInput.text;
      content.author = authorTextInput.text;
      content.authorUrl = authorUrlTextInput.text;
      content.authorEmail = authorEmailTextInput.text;
      content.authorIp = authorIpTextInput.text;
      content.commentsCount = int(commentsCountTextInput.text);
      content.updaterId = int(updaterIdTextInput.text);
      content.version = int(versionTextInput.text);
      content.siteId = int(siteIdTextInput.text);
      content.approved = approvedCheckBox.selected;
      content.commentAge = int(commentAgeTextInput.text);
      content.filter = filterTextInput.text;
      content.userAgent = userAgentTextInput.text;
      content.referrer = referrerTextInput.text;
      content.assetsCount = int(assetsCountTextInput.text);
  
    }
   
    private function destroyContent():void {
      content.destroy({onSuccess: onContentDestroy});
    }
    
    private function onContentSelect():void {
      content = RxUtils.clone(contentsList.selectedItem) as Content;
    }
    
    private function onContentCreate(result:Content):void {
      content = new Content;
    }
    
    private function onContentUpdate(result:Content):void {
      contentsList.selectedItem = result;
      onContentSelect();
    }
    
    private function onContentDestroy(result:Content):void {
      onContentCreate(result);
    }    
  ]]></mx:Script>
  <mx:Panel id="contentsPanel"
    title="Contents" cornerRadius="0" dropShadowEnabled="false" borderStyle="solid"
    borderThickness="1" backgroundColor="#EEEEEE" width="25%" height="100%">
    <mx:List id="contentsList"
      width="100%" height="100%"
      dataProvider="{Rx.models.index(Content)}"
      change="onContentSelect()"/>
    <mx:ControlBar width="100%">
      <mx:Button label="New Content" width="100%" height="30"
        click="newContent()"/>
    </mx:ControlBar>
  </mx:Panel>
  <mx:Panel title="Edit Content" cornerRadius="0" dropShadowEnabled="false" borderStyle="solid"
    borderThickness="1" backgroundColor="#EEEEEE" width="75%" height="100%">
    <mx:Form width="100%" height="100%">
      <mx:FormItem label="ArticleId" width="100%">
        <mx:TextInput id="articleIdTextInput" width="100%" text="{content.articleId}"/>
      </mx:FormItem>
      <mx:FormItem label="UserId" width="100%">
        <mx:TextInput id="userIdTextInput" width="100%" text="{content.userId}"/>
      </mx:FormItem>
      <mx:FormItem label="Title" width="100%">
        <mx:TextInput id="titleTextInput" width="100%" text="{content.title}"/>
      </mx:FormItem>
      <mx:FormItem label="Permalink" width="100%">
        <mx:TextInput id="permalinkTextInput" width="100%" text="{content.permalink}"/>
      </mx:FormItem>
      <mx:FormItem label="Excerpt" width="100%">
        <mx:TextArea id="excerptTextArea" width="100%" height="200" text="{content.excerpt}"/>
      </mx:FormItem>
      <mx:FormItem label="Body" width="100%">
        <mx:TextArea id="bodyTextArea" width="100%" height="200" text="{content.body}"/>
      </mx:FormItem>
      <mx:FormItem label="ExcerptHtml" width="100%">
        <mx:TextArea id="excerptHtmlTextArea" width="100%" height="200" text="{content.excerptHtml}"/>
      </mx:FormItem>
      <mx:FormItem label="BodyHtml" width="100%">
        <mx:TextArea id="bodyHtmlTextArea" width="100%" height="200" text="{content.bodyHtml}"/>
      </mx:FormItem>
      <mx:FormItem label="CreatedAt" width="100%">
        <rx:DateTimeTextInput id="createdAtDateTimeTextInput" width="200" date="{content.createdAt}"/>
      </mx:FormItem>
      <mx:FormItem label="UpdatedAt" width="100%">
        <rx:DateTimeTextInput id="updatedAtDateTimeTextInput" width="200" date="{content.updatedAt}"/>
      </mx:FormItem>
      <mx:FormItem label="PublishedAt" width="100%">
        <rx:DateTimeTextInput id="publishedAtDateTimeTextInput" width="200" date="{content.publishedAt}"/>
      </mx:FormItem>
      <mx:FormItem label="Type" width="100%">
        <mx:TextInput id="typeTextInput" width="100%" text="{content.type}"/>
      </mx:FormItem>
      <mx:FormItem label="Author" width="100%">
        <mx:TextInput id="authorTextInput" width="100%" text="{content.author}"/>
      </mx:FormItem>
      <mx:FormItem label="AuthorUrl" width="100%">
        <mx:TextInput id="authorUrlTextInput" width="100%" text="{content.authorUrl}"/>
      </mx:FormItem>
      <mx:FormItem label="AuthorEmail" width="100%">
        <mx:TextInput id="authorEmailTextInput" width="100%" text="{content.authorEmail}"/>
      </mx:FormItem>
      <mx:FormItem label="AuthorIp" width="100%">
        <mx:TextInput id="authorIpTextInput" width="100%" text="{content.authorIp}"/>
      </mx:FormItem>
      <mx:FormItem label="CommentsCount" width="100%">
        <mx:TextInput id="commentsCountTextInput" width="100%" text="{content.commentsCount}"/>
      </mx:FormItem>
      <mx:FormItem label="UpdaterId" width="100%">
        <mx:TextInput id="updaterIdTextInput" width="100%" text="{content.updaterId}"/>
      </mx:FormItem>
      <mx:FormItem label="Version" width="100%">
        <mx:TextInput id="versionTextInput" width="100%" text="{content.version}"/>
      </mx:FormItem>
      <mx:FormItem label="SiteId" width="100%">
        <mx:TextInput id="siteIdTextInput" width="100%" text="{content.siteId}"/>
      </mx:FormItem>
      <mx:FormItem label="Approved" width="100%">
        <mx:CheckBox id="approvedCheckBox" selected="{content.approved}"/>
      </mx:FormItem>
      <mx:FormItem label="CommentAge" width="100%">
        <mx:TextInput id="commentAgeTextInput" width="100%" text="{content.commentAge}"/>
      </mx:FormItem>
      <mx:FormItem label="Filter" width="100%">
        <mx:TextInput id="filterTextInput" width="100%" text="{content.filter}"/>
      </mx:FormItem>
      <mx:FormItem label="UserAgent" width="100%">
        <mx:TextInput id="userAgentTextInput" width="100%" text="{content.userAgent}"/>
      </mx:FormItem>
      <mx:FormItem label="Referrer" width="100%">
        <mx:TextInput id="referrerTextInput" width="100%" text="{content.referrer}"/>
      </mx:FormItem>
      <mx:FormItem label="AssetsCount" width="100%">
        <mx:TextInput id="assetsCountTextInput" width="100%" text="{content.assetsCount}"/>
      </mx:FormItem>
    </mx:Form>
    <mx:ControlBar width="100%">
      <mx:Button label="Save Content" width="50%" height="30"
        click="saveContent()"/>
      <mx:Button label="Delete Content" width="50%" height="30"
        enabled="{RxUtils.canDeleteModel(content)}"
        click="destroyContent()"/>
    </mx:ControlBar>
  </mx:Panel>
</mx:HBox>