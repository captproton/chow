<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" label="Site"
  xmlns:rx="org.restfulx.components.rx.*">
  <mx:Script><![CDATA[
    import org.restfulx.Rx;
    import org.restfulx.utils.RxUtils;
    import chow.models.Site;

    [Bindable]
    private var site:Site = new Site();

    private function newSite():void {
      site = new Site();
      sitesList.selectedIndex = -1;
    }

    private function saveSite():void {
      updateModelProperties();
      if (site.id) {
        site.update({onSuccess: onSiteUpdate});
      } else {
        site.create({onSuccess: onSiteCreate});
      }
    }
  
    private function updateModelProperties():void {
      site.title = titleTextInput.text;
      site.subtitle = subtitleTextInput.text;
      site.email = emailTextInput.text;
      site.pingUrls = pingUrlsTextArea.text;
      site.articlesPerPage = int(articlesPerPageTextInput.text);
      site.host = hostTextInput.text;
      site.akismetKey = akismetKeyTextInput.text;
      site.akismetUrl = akismetUrlTextInput.text;
      site.approveComments = approveCommentsCheckBox.selected;
      site.commentAge = int(commentAgeTextInput.text);
      site.timezone = timezoneTextInput.text;
      site.filter = filterTextInput.text;
      site.permalinkStyle = permalinkStyleTextInput.text;
      site.searchPath = searchPathTextInput.text;
      site.tagPath = tagPathTextInput.text;
      site.tagLayout = tagLayoutTextInput.text;
      site.currentThemePath = currentThemePathTextInput.text;
      site.createdAt = createdAtDateTimeTextInput.date;
      site.updatedAt = updatedAtDateTimeTextInput.date;
  
    }
   
    private function destroySite():void {
      site.destroy({onSuccess: onSiteDestroy});
    }
    
    private function onSiteSelect():void {
      site = RxUtils.clone(sitesList.selectedItem) as Site;
    }
    
    private function onSiteCreate(result:Site):void {
      site = new Site;
    }
    
    private function onSiteUpdate(result:Site):void {
      sitesList.selectedItem = result;
      onSiteSelect();
    }
    
    private function onSiteDestroy(result:Site):void {
      onSiteCreate(result);
    }    
  ]]></mx:Script>
  <mx:Panel id="sitesPanel"
    title="Sites" cornerRadius="0" dropShadowEnabled="false" borderStyle="solid"
    borderThickness="1" backgroundColor="#EEEEEE" width="25%" height="100%">
    <mx:List id="sitesList"
      width="100%" height="100%"
      dataProvider="{Rx.models.index(Site)}"
      change="onSiteSelect()"/>
    <mx:ControlBar width="100%">
      <mx:Button label="New Site" width="100%" height="30"
        click="newSite()"/>
    </mx:ControlBar>
  </mx:Panel>
  <mx:Panel title="Edit Site" cornerRadius="0" dropShadowEnabled="false" borderStyle="solid"
    borderThickness="1" backgroundColor="#EEEEEE" width="75%" height="100%">
    <mx:Form width="100%" height="100%">
      <mx:FormItem label="Title" width="100%">
        <mx:TextInput id="titleTextInput" width="100%" text="{site.title}"/>
      </mx:FormItem>
      <mx:FormItem label="Subtitle" width="100%">
        <mx:TextInput id="subtitleTextInput" width="100%" text="{site.subtitle}"/>
      </mx:FormItem>
      <mx:FormItem label="Email" width="100%">
        <mx:TextInput id="emailTextInput" width="100%" text="{site.email}"/>
      </mx:FormItem>
      <mx:FormItem label="PingUrls" width="100%">
        <mx:TextArea id="pingUrlsTextArea" width="100%" height="200" text="{site.pingUrls}"/>
      </mx:FormItem>
      <mx:FormItem label="ArticlesPerPage" width="100%">
        <mx:TextInput id="articlesPerPageTextInput" width="100%" text="{site.articlesPerPage}"/>
      </mx:FormItem>
      <mx:FormItem label="Host" width="100%">
        <mx:TextInput id="hostTextInput" width="100%" text="{site.host}"/>
      </mx:FormItem>
      <mx:FormItem label="AkismetKey" width="100%">
        <mx:TextInput id="akismetKeyTextInput" width="100%" text="{site.akismetKey}"/>
      </mx:FormItem>
      <mx:FormItem label="AkismetUrl" width="100%">
        <mx:TextInput id="akismetUrlTextInput" width="100%" text="{site.akismetUrl}"/>
      </mx:FormItem>
      <mx:FormItem label="ApproveComments" width="100%">
        <mx:CheckBox id="approveCommentsCheckBox" selected="{site.approveComments}"/>
      </mx:FormItem>
      <mx:FormItem label="CommentAge" width="100%">
        <mx:TextInput id="commentAgeTextInput" width="100%" text="{site.commentAge}"/>
      </mx:FormItem>
      <mx:FormItem label="Timezone" width="100%">
        <mx:TextInput id="timezoneTextInput" width="100%" text="{site.timezone}"/>
      </mx:FormItem>
      <mx:FormItem label="Filter" width="100%">
        <mx:TextInput id="filterTextInput" width="100%" text="{site.filter}"/>
      </mx:FormItem>
      <mx:FormItem label="PermalinkStyle" width="100%">
        <mx:TextInput id="permalinkStyleTextInput" width="100%" text="{site.permalinkStyle}"/>
      </mx:FormItem>
      <mx:FormItem label="SearchPath" width="100%">
        <mx:TextInput id="searchPathTextInput" width="100%" text="{site.searchPath}"/>
      </mx:FormItem>
      <mx:FormItem label="TagPath" width="100%">
        <mx:TextInput id="tagPathTextInput" width="100%" text="{site.tagPath}"/>
      </mx:FormItem>
      <mx:FormItem label="TagLayout" width="100%">
        <mx:TextInput id="tagLayoutTextInput" width="100%" text="{site.tagLayout}"/>
      </mx:FormItem>
      <mx:FormItem label="CurrentThemePath" width="100%">
        <mx:TextInput id="currentThemePathTextInput" width="100%" text="{site.currentThemePath}"/>
      </mx:FormItem>
      <mx:FormItem label="CreatedAt" width="100%">
        <rx:DateTimeTextInput id="createdAtDateTimeTextInput" width="200" date="{site.createdAt}"/>
      </mx:FormItem>
      <mx:FormItem label="UpdatedAt" width="100%">
        <rx:DateTimeTextInput id="updatedAtDateTimeTextInput" width="200" date="{site.updatedAt}"/>
      </mx:FormItem>
    </mx:Form>
    <mx:ControlBar width="100%">
      <mx:Button label="Save Site" width="50%" height="30"
        click="saveSite()"/>
      <mx:Button label="Delete Site" width="50%" height="30"
        enabled="{RxUtils.canDeleteModel(site)}"
        click="destroySite()"/>
    </mx:ControlBar>
  </mx:Panel>
</mx:HBox>