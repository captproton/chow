<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" label="Section"
  xmlns:rx="org.restfulx.components.rx.*">
  <mx:Script><![CDATA[
    import org.restfulx.Rx;
    import org.restfulx.utils.RxUtils;
    import chow.models.Section;

    [Bindable]
    private var section:Section = new Section();

    private function newSection():void {
      section = new Section();
      sectionsList.selectedIndex = -1;
    }

    private function saveSection():void {
      updateModelProperties();
      if (section.id) {
        section.update({onSuccess: onSectionUpdate});
      } else {
        section.create({onSuccess: onSectionCreate});
      }
    }
  
    private function updateModelProperties():void {
      section.name = nameTextInput.text;
      section.showPagedArticles = showPagedArticlesCheckBox.selected;
      section.articlesPerPage = int(articlesPerPageTextInput.text);
      section.layoutName = layoutNameTextInput.text;
      section.template = templateTextInput.text;
      section.siteId = int(siteIdTextInput.text);
      section.path = pathTextInput.text;
      section.articlesCount = int(articlesCountTextInput.text);
      section.archivePath = archivePathTextInput.text;
      section.archiveTemplate = archiveTemplateTextInput.text;
      section.position = int(positionTextInput.text);
      section.createdAt = createdAtDateTimeTextInput.date;
      section.updatedAt = updatedAtDateTimeTextInput.date;
  
    }
   
    private function destroySection():void {
      section.destroy({onSuccess: onSectionDestroy});
    }
    
    private function onSectionSelect():void {
      section = RxUtils.clone(sectionsList.selectedItem) as Section;
    }
    
    private function onSectionCreate(result:Section):void {
      section = new Section;
    }
    
    private function onSectionUpdate(result:Section):void {
      sectionsList.selectedItem = result;
      onSectionSelect();
    }
    
    private function onSectionDestroy(result:Section):void {
      onSectionCreate(result);
    }    
  ]]></mx:Script>
  <mx:Panel id="sectionsPanel"
    title="Sections" cornerRadius="0" dropShadowEnabled="false" borderStyle="solid"
    borderThickness="1" backgroundColor="#EEEEEE" width="25%" height="100%">
    <mx:List id="sectionsList"
      width="100%" height="100%"
      dataProvider="{Rx.models.index(Section)}"
      change="onSectionSelect()"/>
    <mx:ControlBar width="100%">
      <mx:Button label="New Section" width="100%" height="30"
        click="newSection()"/>
    </mx:ControlBar>
  </mx:Panel>
  <mx:Panel title="Edit Section" cornerRadius="0" dropShadowEnabled="false" borderStyle="solid"
    borderThickness="1" backgroundColor="#EEEEEE" width="75%" height="100%">
    <mx:Form width="100%" height="100%">
      <mx:FormItem label="Name" width="100%">
        <mx:TextInput id="nameTextInput" width="100%" text="{section.name}"/>
      </mx:FormItem>
      <mx:FormItem label="ShowPagedArticles" width="100%">
        <mx:CheckBox id="showPagedArticlesCheckBox" selected="{section.showPagedArticles}"/>
      </mx:FormItem>
      <mx:FormItem label="ArticlesPerPage" width="100%">
        <mx:TextInput id="articlesPerPageTextInput" width="100%" text="{section.articlesPerPage}"/>
      </mx:FormItem>
      <mx:FormItem label="LayoutName" width="100%">
        <mx:TextInput id="layoutNameTextInput" width="100%" text="{section.layoutName}"/>
      </mx:FormItem>
      <mx:FormItem label="Template" width="100%">
        <mx:TextInput id="templateTextInput" width="100%" text="{section.template}"/>
      </mx:FormItem>
      <mx:FormItem label="SiteId" width="100%">
        <mx:TextInput id="siteIdTextInput" width="100%" text="{section.siteId}"/>
      </mx:FormItem>
      <mx:FormItem label="Path" width="100%">
        <mx:TextInput id="pathTextInput" width="100%" text="{section.path}"/>
      </mx:FormItem>
      <mx:FormItem label="ArticlesCount" width="100%">
        <mx:TextInput id="articlesCountTextInput" width="100%" text="{section.articlesCount}"/>
      </mx:FormItem>
      <mx:FormItem label="ArchivePath" width="100%">
        <mx:TextInput id="archivePathTextInput" width="100%" text="{section.archivePath}"/>
      </mx:FormItem>
      <mx:FormItem label="ArchiveTemplate" width="100%">
        <mx:TextInput id="archiveTemplateTextInput" width="100%" text="{section.archiveTemplate}"/>
      </mx:FormItem>
      <mx:FormItem label="Position" width="100%">
        <mx:TextInput id="positionTextInput" width="100%" text="{section.position}"/>
      </mx:FormItem>
      <mx:FormItem label="CreatedAt" width="100%">
        <rx:DateTimeTextInput id="createdAtDateTimeTextInput" width="200" date="{section.createdAt}"/>
      </mx:FormItem>
      <mx:FormItem label="UpdatedAt" width="100%">
        <rx:DateTimeTextInput id="updatedAtDateTimeTextInput" width="200" date="{section.updatedAt}"/>
      </mx:FormItem>
    </mx:Form>
    <mx:ControlBar width="100%">
      <mx:Button label="Save Section" width="50%" height="30"
        click="saveSection()"/>
      <mx:Button label="Delete Section" width="50%" height="30"
        enabled="{RxUtils.canDeleteModel(section)}"
        click="destroySection()"/>
    </mx:ControlBar>
  </mx:Panel>
</mx:HBox>